import 'dart:typed_data';

import 'package:authorityeditor/authority/authority.dart';
import 'package:authorityeditor/authority/src/bindings.dart';
import 'package:authorityeditor/authority/src/bindings/tree.dart';
import 'package:test/test.dart';
import 'dart:io' show Directory;
import 'package:path/path.dart' as path;

List<int> byts = [
  0x05,
  0x01,
  0x16,
  0x41,
  0x62,
  0x6f,
  0x75,
  0x74,
  0x20,
  0x74,
  0x68,
  0x65,
  0x20,
  0x6f,
  0x72,
  0x67,
  0x61,
  0x6e,
  0x69,
  0x73,
  0x61,
  0x74,
  0x69,
  0x6f,
  0x6e,
  0x3d,
  0x41,
  0x62,
  0x6f,
  0x75,
  0x74,
  0x20,
  0x72,
  0x65,
  0x6c,
  0x61,
  0x74,
  0x69,
  0x6f,
  0x6e,
  0x73,
  0x68,
  0x69,
  0x70,
  0x73,
  0x20,
  0x77,
  0x69,
  0x74,
  0x68,
  0x20,
  0x6f,
  0x74,
  0x68,
  0x65,
  0x72,
  0x20,
  0x6f,
  0x72,
  0x67,
  0x61,
  0x6e,
  0x69,
  0x73,
  0x61,
  0x74,
  0x69,
  0x6f,
  0x6e,
  0x73,
  0x20,
  0x61,
  0x6e,
  0x64,
  0x20,
  0x73,
  0x74,
  0x61,
  0x6b,
  0x65,
  0x68,
  0x6f,
  0x6c,
  0x64,
  0x65,
  0x72,
  0x73,
  0x10,
  0x41,
  0x62,
  0x6f,
  0x75,
  0x74,
  0x20,
  0x63,
  0x6f,
  0x6d,
  0x6d,
  0x69,
  0x74,
  0x74,
  0x65,
  0x65,
  0x73,
  0x2a,
  0x41,
  0x62,
  0x6f,
  0x75,
  0x74,
  0x20,
  0x74,
  0x68,
  0x65,
  0x20,
  0x72,
  0x65,
  0x63,
  0x6f,
  0x72,
  0x64,
  0x73,
  0x20,
  0x68,
  0x65,
  0x6c,
  0x64,
  0x20,
  0x62,
  0x79,
  0x20,
  0x74,
  0x68,
  0x65,
  0x20,
  0x6f,
  0x72,
  0x67,
  0x61,
  0x6e,
  0x69,
  0x73,
  0x61,
  0x74,
  0x69,
  0x6f,
  0x6e,
  0x36,
  0x41,
  0x62,
  0x6f,
  0x75,
  0x74,
  0x20,
  0x61,
  0x6e,
  0x79,
  0x20,
  0x65,
  0x78,
  0x74,
  0x65,
  0x72,
  0x6e,
  0x61,
  0x6c,
  0x20,
  0x73,
  0x74,
  0x61,
  0x6b,
  0x65,
  0x68,
  0x6f,
  0x6c,
  0x64,
  0x65,
  0x72,
  0x20,
  0x63,
  0x6f,
  0x6e,
  0x73,
  0x75,
  0x6c,
  0x74,
  0x61,
  0x74,
  0x69,
  0x6f,
  0x6e,
  0x20,
  0x75,
  0x6e,
  0x64,
  0x65,
  0x72,
  0x74,
  0x61,
  0x6b,
  0x65,
  0x6e,
  0x03,
  0x05,
  0x33,
  0x2e,
  0x30,
  0x2e,
  0x30,
  0x0f,
  0x46,
  0x49,
  0x52,
  0x45,
  0x20,
  0x4d,
  0x41,
  0x4e,
  0x41,
  0x47,
  0x45,
  0x4d,
  0x45,
  0x4e,
  0x54,
  0x02,
  0x03,
  0x05,
  0x33,
  0x2e,
  0x33,
  0x2e,
  0x30,
  0x0d,
  0x46,
  0x69,
  0x72,
  0x65,
  0x20,
  0x70,
  0x6c,
  0x61,
  0x6e,
  0x6e,
  0x69,
  0x6e,
  0x67,
  0x01,
  0x02,
  0x05,
  0x33,
  0x2e,
  0x33,
  0x2e,
  0x31,
  0x00,
  0x03,
  0x05,
  0x33,
  0x2e,
  0x36,
  0x2e,
  0x30,
  0x0c,
  0x52,
  0x65,
  0x67,
  0x65,
  0x6e,
  0x65,
  0x72,
  0x61,
  0x74,
  0x69,
  0x6f,
  0x6e,
  0x02,
  0x02,
  0x05,
  0x33,
  0x2e,
  0x36,
  0x2e,
  0x31,
  0x00,
  0x02,
  0x05,
  0x33,
  0x2e,
  0x36,
  0x2e,
  0x32,
  0x00,
];

void main() async {
  final rda = Session();
  await rda.init();
  final examplePath = path.join(
    Directory.current.path,
    'test',
    'SRNSW_example.xml',
  );
  final doc = await rda.load(examplePath);
  test('validate the doc', () async {
    final valid = await rda.valid(doc);
    expect(valid, true);
  });
  test('print the doc', () async {
    final str = await rda.asString(doc);
    expect(str.length, 11034);
  });
  test('tree', () async {
    final tree = await rda.tree(doc);
    expect(tree.length, 3);
  });
  test('paragraphs', () {
    final tree = AsTree(Uint8List.fromList(byts), Counter());
    expect(tree.length, 3);
  });
}
